# 管理员账户自动初始化功能

## 功能概述

系统现在具备自动检查和创建管理员账户的功能，确保每次启动时都有可用的管理员账户。

## 实现的功能

### 1. 管理员初始化服务 (`AdminInitializationService`)

**文件位置**: `backend/src/services/admin_init_service.py`

**主要功能**:
- 检查管理员账户是否存在
- 自动创建管理员账户（如果不存在）
- 初始化数据库架构（添加 `role` 字段）
- 支持环境变量配置

**核心方法**:
- `check_admin_exists()` - 检查是否有管理员用户
- `create_admin_user()` - 创建管理员账户
- `ensure_admin_exists()` - 确保管理员账户存在
- `initialize_database_schema()` - 初始化数据库架构

### 2. 应用启动时自动初始化

**文件位置**: `backend/src/app.py`

**实现方式**:
- 使用 FastAPI 的 `lifespan` 上下文管理器
- 在应用启动时自动执行管理员账户检查
- 如果数据库缺少 `role` 字段，自动添加
- 如果缺少管理员账户，自动创建

### 3. 环境变量配置

**文件位置**: `backend/env.example`

**可配置项**:
```bash
# 管理员账户配置（可选，使用默认值）
ADMIN_USERNAME=admin
ADMIN_EMAIL=admin@example.com
ADMIN_PASSWORD=admin
ADMIN_DISPLAY_NAME=系统管理员
```

## 默认管理员账户

如果系统检测到没有管理员账户，会自动创建：

- **用户名**: `admin`
- **邮箱**: `admin@example.com`
- **密码**: `admin`
- **显示名称**: `系统管理员`
- **角色**: `admin`

## 工作流程

1. **应用启动** → 执行 `lifespan` 函数
2. **数据库架构检查** → 检查 `users` 表是否有 `role` 字段
3. **架构更新** → 如果缺少字段，自动添加
4. **管理员检查** → 检查是否有管理员用户
5. **创建管理员** → 如果没有，自动创建默认管理员账户
6. **启动完成** → 应用正常启动

## 日志输出

启动时会看到以下日志：

```
🚀 正在启动 AI Native 智能工作台...
📊 正在初始化数据库架构...
✅ 数据库架构检查通过
👤 正在检查管理员账户...
✅ 管理员账户检查完成
🎉 AI Native 智能工作台启动完成！
```

## 安全考虑

1. **默认密码**: 默认管理员密码是 `admin`，生产环境建议通过环境变量修改
2. **权限控制**: 只有管理员可以访问用户管理功能
3. **数据验证**: 所有用户操作都有完整的数据验证
4. **错误处理**: 完善的错误处理和回滚机制

## 测试验证

可以通过以下方式验证功能：

1. **查看启动日志**: 确认初始化过程正常
2. **数据库检查**: 确认 `role` 字段和管理员账户存在
3. **前端测试**: 使用管理员账户登录并访问用户管理功能

## 未来扩展

- 支持多个管理员账户
- 更细粒度的权限控制
- 管理员账户的批量管理
- 用户导入/导出功能
